{{define "title"}}dashboard{{end}}
{{define "content"}}
{{if .Error}}<div class="alert alert-error">{{.Error}}</div>{{end}}
{{if .Success}}<div class="alert alert-success">{{.Success}}</div>{{end}}

<div class="stats">
    <div class="stat-card">
        <div class="value">{{printf "%.1f" .TotalHours}}</div>
        <div class="label">total overtime hours{{if or .SelectedTeamID .SelectedProjectID .SelectedMonth}} (filtered){{end}}</div>
    </div>
</div>

{{if .User.CanViewAllOvertime}}
<div class="card">
    <h2>filters</h2>
    <form method="GET" action="/dashboard" class="filter-form">
        <div class="filter-row">
            <div class="form-group" style="display: inline-block; margin-right: 15px;">
                <label for="team_id">team</label>
                <select id="team_id" name="team_id">
                    <option value="">All Teams</option>
                    {{range .Teams}}
                    <option value="{{.ID}}" {{if eq .ID $.SelectedTeamID}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group" style="display: inline-block; margin-right: 15px;">
                <label for="project_id">project</label>
                <select id="project_id" name="project_id">
                    <option value="">All Projects</option>
                    {{range .Projects}}
                    <option value="{{.ID}}" {{if eq .ID $.SelectedProjectID}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group" style="display: inline-block; margin-right: 15px;">
                <label for="month">month</label>
                <select id="month" name="month">
                    <option value="">All Months</option>
                    <option value="1" {{if eq .SelectedMonth 1}}selected{{end}}>January</option>
                    <option value="2" {{if eq .SelectedMonth 2}}selected{{end}}>February</option>
                    <option value="3" {{if eq .SelectedMonth 3}}selected{{end}}>March</option>
                    <option value="4" {{if eq .SelectedMonth 4}}selected{{end}}>April</option>
                    <option value="5" {{if eq .SelectedMonth 5}}selected{{end}}>May</option>
                    <option value="6" {{if eq .SelectedMonth 6}}selected{{end}}>June</option>
                    <option value="7" {{if eq .SelectedMonth 7}}selected{{end}}>July</option>
                    <option value="8" {{if eq .SelectedMonth 8}}selected{{end}}>August</option>
                    <option value="9" {{if eq .SelectedMonth 9}}selected{{end}}>September</option>
                    <option value="10" {{if eq .SelectedMonth 10}}selected{{end}}>October</option>
                    <option value="11" {{if eq .SelectedMonth 11}}selected{{end}}>November</option>
                    <option value="12" {{if eq .SelectedMonth 12}}selected{{end}}>December</option>
                </select>
            </div>
            <div class="form-group" style="display: inline-block; margin-right: 15px;">
                <label for="year">year</label>
                <select id="year" name="year">
                    <option value="">All Years</option>
                    {{range .Years}}
                    <option value="{{.}}" {{if eq . $.SelectedYear}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">[APPLY FILTERS]</button>
        <a href="/dashboard" class="btn btn-secondary">[CLEAR]</a>
    </form>
</div>
{{end}}

<div class="card">
    <h2>{{if .User.CanViewAllOvertime}}recent entries (all users){{else}}my overtime entries{{end}}</h2>

    {{if or .User.IsAdmin .User.IsEmployee}}
    <a href="/overtime/new" class="btn">[+ ADD ENTRY]</a>
    {{end}}

    {{if .Entries}}
    <table>
        <thead>
            <tr>
                {{if .User.CanViewAllOvertime}}<th>employee</th>{{end}}
                {{if .User.CanViewAllOvertime}}<th>team</th>{{end}}
                {{if .User.CanViewAllOvertime}}<th>project</th>{{end}}
                <th>date</th>
                <th>hours</th>
                <th>description</th>
                {{if or .User.IsAdmin .User.IsEmployee}}<th>actions</th>{{end}}
            </tr>
        </thead>
        <tbody>
            {{range .Entries}}
            <tr>
                {{if $.User.CanViewAllOvertime}}<td>{{.User.DisplayName}}</td>{{end}}
                {{if $.User.CanViewAllOvertime}}<td>{{if .User.Team}}{{.User.Team.Name}}{{else}}<span style="color:#555">-</span>{{end}}</td>{{end}}
                {{if $.User.CanViewAllOvertime}}<td>{{if .User.Project}}{{.User.Project.Name}}{{else}}<span style="color:#555">-</span>{{end}}</td>{{end}}
                <td>{{.Date.Format "2006-01-02"}}</td>
                <td>{{printf "%.2f" .Hours}}</td>
                <td title="{{.Description}}">{{if gt (len .Description) 50}}{{slice .Description 0 50}}...{{else}}{{.Description}}{{end}}</td>
                {{if $.User.CanManageOvertimeFor .UserID}}
                <td class="actions">
                    <a href="/overtime/edit?id={{.ID}}" class="btn btn-primary">[EDIT]</a>
                    <form method="POST" action="/overtime/delete" onsubmit="return confirm('Delete this entry?');">
                        <input type="hidden" name="id" value="{{.ID}}">
                        <button type="submit" class="btn btn-danger">[DEL]</button>
                    </form>
                </td>
                {{else if or $.User.IsAdmin $.User.IsEmployee}}
                <td></td>
                {{end}}
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="color: #888; margin-top: 15px;">No overtime entries found.</p>
    {{end}}
</div>
{{end}}
{{template "base" .}}
